<!DOCTYPE html>
<html lang="en" data-bs-theme="dark">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <!-- Content Security Policy -->
    <meta http-equiv="Content-Security-Policy" content="
        default-src 'self';
        script-src 'self' 'unsafe-inline' https://cdn.jsdelivr.net;
        style-src 'self' 'unsafe-inline' https://cdn.jsdelivr.net https://fonts.googleapis.com;
        font-src 'self' https://fonts.gstatic.com https://cdn.jsdelivr.net data:;
        img-src 'self' data: blob:;
        connect-src 'self';
        frame-ancestors 'none';
        base-uri 'self';
        form-action 'none';
    ">
    <!-- Additional Security Headers -->
    <meta http-equiv="X-Content-Type-Options" content="nosniff">
    <meta name="referrer" content="no-referrer">
    <title>Toddler Typing</title>

    <!-- Bootstrap 5.3 CSS with Subresource Integrity -->
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-QWTKZyjpPEjISv5WaRU9OFeRpok6YctnYmDr5pNlyT2bRjXh0JMhjY6hW+ALEwIH" crossorigin="anonymous">
    <!-- Bootstrap Icons with Subresource Integrity -->
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.3/font/bootstrap-icons.min.css" integrity="sha384-XGjxtQfXaH2tnPFa9x+ruJTuLE3Aa6LhHSWRr1XeTyhezb4abCG4ccI5AkVDxqC+" crossorigin="anonymous">
    <!-- Google Fonts -->
    <link href="https://fonts.googleapis.com/css2?family=Nunito:wght@400;600;700;800&display=swap" rel="stylesheet">
    <!-- Custom CSS -->
    <link rel="stylesheet" href="css/custom.css">
</head>
<body>
    <!-- Header with controls -->
    <header class="page-header">
        <div class="header-controls">
            <!-- Mute Toggle -->
            <button id="muteToggle" class="btn-icon" title="Mute/Unmute">
                <i class="bi bi-volume-up-fill"></i>
            </button>
            <!-- Theme Toggle -->
            <button id="themeToggle" class="btn-icon" title="Toggle Theme">
                <i class="bi bi-moon-fill"></i>
            </button>
            <!-- Fullscreen Toggle -->
            <button id="fullscreenToggle" class="btn-icon" title="Toggle Fullscreen">
                <i class="bi bi-fullscreen"></i>
            </button>
        </div>
    </header>

    <!-- Main Page Container -->
    <div class="page-container">
        <!-- 3D Character Container (global - appears on all pages) -->
        <div id="character-container"></div>

        <!-- Main Menu (centered) -->
        <div id="mainMenu" class="menu-wrapper">
            <h1 class="menu-title text-gradient">Let's Play!</h1>

            <!-- 3x2 Grid -->
            <div class="activity-grid">
                <!-- Letters & Numbers -->
                <button class="activity-card" onclick="startActivity('letters_numbers')">
                    <i class="bi bi-alphabet card-icon"></i>
                    <h3 class="card-title">Letters & Numbers</h3>
                    <p class="card-subtitle">Learn ABC and 123</p>
                </button>

                <!-- Drawing -->
                <button class="activity-card card-drawing" onclick="startActivity('drawing')">
                    <i class="bi bi-brush card-icon"></i>
                    <h3 class="card-title">Drawing</h3>
                    <p class="card-subtitle">Create beautiful art</p>
                </button>

                <!-- Colors & Shapes -->
                <button class="activity-card card-shapes" onclick="startActivity('colors_shapes')">
                    <i class="bi bi-triangle card-icon"></i>
                    <h3 class="card-title">Colors & Shapes</h3>
                    <p class="card-subtitle">Discover colors and shapes</p>
                </button>

                <!-- Dot to Dot -->
                <button class="activity-card card-dot2dot" onclick="startActivity('dot2dot')">
                    <i class="bi bi-diagram-3 card-icon"></i>
                    <h3 class="card-title">Dot to Dot</h3>
                    <p class="card-subtitle">Connect the dots</p>
                </button>

                <!-- Sounds -->
                <button class="activity-card card-sounds" onclick="startActivity('sounds')">
                    <i class="bi bi-megaphone card-icon"></i>
                    <h3 class="card-title">Sounds</h3>
                    <p class="card-subtitle">Learn letter sounds</p>
                </button>

                <!-- Coloring -->
                <button class="activity-card card-coloring" onclick="startActivity('coloring')">
                    <i class="bi bi-palette card-icon"></i>
                    <h3 class="card-title">Coloring</h3>
                    <p class="card-subtitle">Paint and color pictures</p>
                </button>
            </div>
        </div>

        <!-- Activity Screens (hidden by default) -->
        <div id="activityScreen" class="activity-screen-wrapper">
            <button class="btn-back" onclick="returnToMenu()">
                <i class="bi bi-arrow-left"></i> Back to Menu
            </button>
            <div id="activityContent">
                <!-- Activity content will be loaded here -->
            </div>
        </div>
    </div>

    <!-- Footer -->
    <footer class="page-footer">
        <small id="versionLabel">v1.1.4</small>
    </footer>

    <!-- Bootstrap 5.3 JS Bundle with Subresource Integrity -->
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js" integrity="sha384-YvpcrYf0tY3lHB60NNkmXc5s9fDVZLESaAA55NDzOxhy9GkcIdslK1eN7N6jIeHz" crossorigin="anonymous"></script>
    <!-- Three.js for 3D rendering with Subresource Integrity -->
    <script src="https://cdn.jsdelivr.net/npm/three@0.160.0/build/three.min.js" integrity="sha384-X63pB2V0LgWiJ/FWE73OqPYXdRw/tsMw7jEvQQk3BQrnQPl+W15PExaHFhbwHT3y" crossorigin="anonymous"></script>
    <script src="https://cdn.jsdelivr.net/npm/three@0.160.0/examples/js/loaders/GLTFLoader.js" integrity="sha384-fWz2F+N1R9c9F+JLgI7DL+n3VXOlgUYFg/V3Jp+PfyfGrfFQWnhxKT7VXnz9aJg9" crossorigin="anonymous"></script>
    <!-- Activity modules -->
    <script src="js/activities/letters_numbers.js"></script>
    <script src="js/activities/drawing.js"></script>
    <script src="js/activities/colors_shapes.js"></script>
    <script src="js/activities/dot2dot.js"></script>
    <script src="js/activities/sounds.js"></script>
    <script src="js/activities/coloring.js"></script>
    <!-- Character Managers (3D primary, 2D fallback) -->
    <script src="js/character_manager.js"></script>
    <script>
        // Rename CharacterManager to avoid conflicts
        if (typeof CharacterManager !== 'undefined') {
            window.CharacterManager3D = CharacterManager;
            console.log('3D CharacterManager loaded');
        }
    </script>
    <script src="js/character_manager_2d.js"></script>
    <script>
        // Set up fallback logic
        if (typeof CharacterManager !== 'undefined') {
            window.CharacterManager2D = CharacterManager;
            console.log('2D CharacterManager loaded');
        }
        // Restore 3D as default if available
        if (typeof CharacterManager3D !== 'undefined') {
            CharacterManager = CharacterManager3D;
        }
    </script>
    <!-- Custom JS -->
    <script src="js/app.js"></script>
</body>
</html>
